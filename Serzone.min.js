var Serzone={action:{}};function arrayify(b){return Array.prototype.slice.call(b)}
function makeIndex(b,a,d){void 0!=b.body.getElementsByClassName("indexTable")[0]&&b.body.removeChild(b.body.getElementsByClassName("indexTable")[0]);var e=document.createElement("table");e.appendChild(b.children.map(function(b){var d=document.createElement("td");b.order<=a?d.appendChild(b.body):d.appendChild(b.body.getElementsByTagName("h1")[0].cloneNode(!0));return d}).reduce(function(a,b){1==a[a.length-1].length?a[a.length-1].push(b):a.push([b]);return a},[[]]).reduce(function(a,b){var d=b.reduce(function(a,
b){a.appendChild(b);return a},document.createElement("tr"));a.appendChild(d);return a},document.createElement("tbody")));e.classList.add("indexTable");e.style.marginTop="30px";e.style.marginBottom="10px";e.style.webkitTransformOrigin="left top";e.style.webkitTransform="scale("+d+", "+d+")";e.style.webkitTransition="all 1s ease-in-out 0ms";return e}var left=40;function getOffset(b){for(var a=0,d=0;null!=b;)a+=b.offsetLeft,d+=b.offsetTop,b=b.offsetParent;return{x:a,y:d}}
Serzone.action={changeSlide:{type:"next",init:function(b){var a=b.obj;0==a.order&&(document.body.removeChild(document.getElementById("serzone")),Serzone.canvas.style.webkitTransition="-webkit-transform 1s ease-in-out 0ms");if(0==a.children.length)if(0<a.depth){var d=a.parent.body.parentNode,b=makeIndex(a.parent,a.order,0.5);d.removeChild(a.parent.body);a.parent.body.appendChild(b);d.appendChild(a.parent.body);a=getOffset(a.body.parentNode);Serzone.canvas.style.webkitTransform="translate("+(left-a.x)+
"px, "+(10-a.y)+"px)";b.style.webkitTransform="scale(1, 1)";b.style.webkitTransformOrigin="left top"}else Serzone.canvas.appendChild(a.body),Serzone.canvas.style.webkitTransform="translate("+(left-a.body.offsetLeft)+"px, "+(10-a.body.offsetTop)+"px)";else{if(0<a.depth){d=a.parent.body.parentNode;d.removeChild(a.parent.body);b=makeIndex(a,a.order,1);a.body.appendChild(b);var e=makeIndex(a.parent,a.order,0.5);a.parent.body.appendChild(e);d.appendChild(a.parent.body);a=getOffset(a.body.parentNode);Serzone.canvas.style.webkitTransform=
"translate("+(left-a.x)+"px, "+(10-a.y)+"px)";e.style.webkitTransform="scale(1, 1)";e.style.webkitTransformOrigin="left top"}else b=makeIndex(a,a.order,1),a.body.appendChild(b),Serzone.canvas.appendChild(a.body),a=getOffset(a.body),Serzone.canvas.style.webkitTransform="translate("+(left-a.x)+"px, "+(10-a.y)+"px)";b.style.webkitTransform="scale(0.5, 0.5)";b.style.webkitTransformOrigin="left top"}},fire:function(b){var a=b.obj;if(0<a.depth){var d=a.parent.body.parentNode;d.removeChild(a.parent.body);
b=makeIndex(a.parent,a.order,1);a.parent.body.appendChild(b);d.appendChild(a.parent.body);a=getOffset(a.parent.body);Serzone.canvas.style.webkitTransform="translate("+(left-a.x)+"px, "+(10-a.y)+"px)";b.style.webkitTransform="scale(0.5, 0.5)";b.style.webkitTransformOrigin="left top"}}},appear:{type:"inherit",init:function(b){b.obj.style.webkitTransition="color 0s ease-in-out 0ms";b.obj.style.webkitTransition="color 1s ease-in-out 0ms"},fire:function(b){b.obj.style.color="#000";b.obj.style.textShadow=
"0 2px 2px rgba(0, 0, 0, .1)"}},src:{type:"inherit",init:function(b){b.obj.style.webkitTransition="opacity .5s linear";arrayify(b.obj.querySelectorAll("pre code")).filter(function(a){return 3!=a.nodeType}).forEach(function(a){console.log(a);hljs.highlightBlock(a,'<span class="indent"></span>',!1)})},fire:function(b){b.obj.style.opacity="0.5"}},dvi:{type:"inherit",init:function(){},fire:function(b){var a=b.obj.innerText.replace("/s/g","");arrayify(b.obj.childNodes).filter(function(a){return"dvi"==
a.id}).push();dvi_load("#dvi",a);arrayify(b.obj.childNodes).filter(function(a){return 3==a.nodeType}).forEach(function(a){b.obj.removeChild(a)})}}};(function(){function b(a,g){g=g||document;return g.getElementById(a)}function a(a,g){var g=g||document,b=g.querySelectorAll(a);return Array.prototype.slice.call(b)}function d(b,g){var c=a(b,g),f=Node.DOCUMENT_POSITION_FOLLOWING|Node.DOCUMENT_POSITION_CONTAINED_BY;return c.filter(function(a){return c.every(function(b){return b.compareDocumentPosition(a)!=f})})}function e(a){Object.defineProperties(this,{elem:{value:a,writable:!0,configurable:!1},css:{value:[],writable:!0,configurable:!1}})}function j(a,
b){Object.defineProperties(this,{$order:{value:a,writable:!0,enumerable:!1,configurable:!1},$parent:{value:b,writable:!0,enumerable:!1,configurable:!1},$children:{value:[],writable:!0,enumerable:!1,configurable:!1},$siblings:{value:[],writable:!0,enumerable:!1,configurable:!1}})}function h(a,b,c,f){j.call(this,a,f);Object.defineProperties(this,{obj:{value:b,writable:!0,configurable:!1},name:{value:c,writable:!1,configurable:!1},type:{value:Serzone.action[c].type,writable:!1,configurable:!1},flag:{value:!1,
writable:!0,configurable:!1},init:{value:function(){this.flag=!0;return Serzone.action[c].init(this)},writable:!1,configurable:!1},fire:{value:function(){return this.flag?Serzone.action[c].fire(this):this.init(this)},writable:!1,configurable:!1}})}function k(a,b,c){j.call(this,a,c);Object.defineProperties(this,{$elem:{value:b,writable:!1,configurable:!1},$steps:{value:void 0,writable:!0,configurable:!1},css:{value:new e(b),writable:!0,configurable:!1},body:{value:document.createElement("div"),writable:!0,
configurable:!1}});this.body.classList.add("slide");var f=this;Array.prototype.slice.call(b.childNodes).forEach(function(a){f.body.appendChild(a.cloneNode(!0))})}Serzone.canvas=document.createElement("div");Serzone.canvas.classList.add("canvas");e.prototype={get:function(a){return this.css[a||-1]},set:function(a){for(var b in a)this.elem.style.setProperty(b,a[b]);this.css.push(this.elem.style);return!0},undo:function(a){elem.style=css[a||1];css.pop();return!1}};Object.defineProperties(j.prototype,
{order:{get:function(){if(void 0==this.$order)throw Error("order property is not defined.");return this.$order},set:function(a){this.$order=a},configurable:!1},parent:{get:function(){return this.$parent},set:function(a){this.$parent=a},configurable:!1},depth:{get:function(){return function g(a,b){return null==a.parent?b:g(a.parent,b+1)}(this,0)}},children:{get:function(){return this.$children},set:function(a){this.$children=this.$children.concat(a).sort(function(a,b){return a.order-b.order})},configurable:!1},
siblings:{get:function(){return this.$siblings},set:function(a){this.$siblings=this.$siblings.concat(a).sort(function(a,b){return a.order-b.order})},configurable:!1},descendants:{get:function(){return this.children.reduce(function(a,b){return a.concat(b.descendants)},this.children)},configurable:!1},nextSibling:{get:function(){var a=this,b=this.siblings.filter(function(b){return b.order>=a.order});return 0!=b.length?b[0]:null},configurable:!1},next:{get:function(){return 0!=this.children.length?this.children[0]:
function g(a){return null!=a.nextSibling?a.nextSibling:null!=a.parent?g(a.parent):null}(this)},configurable:!1},previous:{get:function(){var a=this,b=this.siblings.filter(function(b){return b.order<a.order}).pop();return void 0==b?this.parent:b.next==this?b:b.descendants.pop()}}});h.prototype=Object.create(j.prototype);h.prototype.constructor=h;k.prototype=Object.create(j.prototype);k.prototype.constructor=k;Object.defineProperties(k.prototype,{steps:{get:function(){function a(f,e,m){if("SECTION"==
f.tagName){var i=new h(m,b.children[c],"changeSlide",e);b.body.removeChild(f);i.children=b.children[c++].steps}else i=new h(m,f,f.getAttribute("action"),e),i.children=d(".step, section",f).map(function(f,d){var e=new h(m,b.children[c],"changeSlide",i);return"SECTION"==f.tagName?(e.children=b.children[c++].steps,e):a(f,i,d)}),i.children.forEach(function(a,b,c){a.siblings=c.slice(0,b);a.siblings=c.slice(b+1)});return i}var b=this,c=0;void 0==this.$steps&&(this.$steps=d(".step, section",this.body).map(function(b,
c){return a(b,null,c)}),this.$steps.forEach(function(a,b,c){a.siblings=c.slice(0,b);a.siblings=c.slice(b+1)}));return this.$steps}}});var l={slides:[],steps:[],init:function(){if(null==b("serzone"))throw Error("Don't have element which has id=serzone");},slideParser:function(){function n(a,b,f){var e=new k(b,a,f||null),a=d("section",a).map(function(a){a=n(a,b+1,e);b+=a.descendants.length+1;return a});a.forEach(function(a,b,c){a.siblings=c.slice(0,b);a.siblings=c.slice(b+1)});e.children=a;return e}
this.slides=d("section",b("serzone")).map(function(b,c,f){c=0==c?0:a("section",f[c-1]).length+1;return n(b,c)});this.slides.forEach(function(a,b,f){a.siblings=f.slice(0,b);a.siblings=f.slice(b+1)})},stepParser:function(){this.steps=this.slides.map(function(a,b){var c=new h(b,a,"changeSlide",null);a.steps.forEach(function(a){a.parent=c});c.children=a.steps;return c});this.steps.forEach(function(a,b,c){a.siblings=c.slice(0,b);a.siblings=c.slice(b+1)})},parse:function(){try{this.init(),this.slideParser(),
this.stepParser()}catch(a){throw a;}}},o={$eventType:{next:{mouse:["click"],keycode:[32,39]},previous:{mouse:void 0,keycode:[37]}},$slide:void 0,$stack:[],refreshStack:function(){var a=this;this.$stack=function c(b){if("inherit"==b.type){b.init();var d=[b];return d=d.concat(b.children.reduce(function(a,b){return a.concat(c(b))},[]))}return[{fire:function(){b.fire();a.$stack=b.children.reduce(function(a,b){return a.concat(c(b))},[]).concat(b).concat(a.$stack)}}]}(this.$slide)},next:function(){var a=
this.$stack.shift();void 0!=a&&a.fire();0>=this.$stack.length&&null!=this.$slide.nextSibling&&(this.$slide=this.$slide.nextSibling,this.refreshStack())},start:function(a){this.$slide=a;this.refreshStack();for(var a=document.location.hash?Number(document.location.hash.replace("#","")):1,b=this,c=0;c<a;c++)setTimeout(function(){b.next(c)},1);this.setEvent(a)},setEvent:function(a){var b=this;document.body.addEventListener("keydown",function(c){-1<b.$eventType.next.keycode.indexOf(c.keyCode)&&(b.next(a),
a++,document.location.hash=a)})}};Serzone.start=function(){document.body.insertBefore(this.canvas,b("serzone"));l.init();l.parse();this.slides=l.slides;this.steps=l.steps;o.start(this.steps[0])}})();
